version: '3.8'

services:
  contracts-copilot:
    build: .
    container_name: contracts-copilot
    ports:
      - "8030:8080"   # external:internal - nginx listens on 8080 internally
    restart: always
    environment:
      # MySQL Configuration
      - MYSQL_HOST=62.72.57.99
      - MYSQL_USER=aabo
      - MYSQL_PASSWORD=3#hxFkBFKJ2Ph!$$@
      - MYSQL_DATABASE=aaboRing10Jan
      # Llama Configuration
      - LLAMA_API_URL=http://34.131.37.125:11434/api/generate
      - LLAMA_MODEL=llama3
      # Qdrant Configuration
      - QDRANT_URL=http://34.131.37.125:6333
      - QDRANT_COLLECTION_NAME=contracts
      # Embedding Service Configuration
      - EMBEDDING_API_URL=http://34.131.37.125:8000/embed
      # OpenAI Configuration
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - OPENAI_MODEL=gpt-4o-mini
      # Wage schedule database
      - WAGE_DB_HOST=72.60.96.212
      - WAGE_DB_PORT=3306
      - WAGE_DB_USER=external
      - WAGE_DB_PASSWORD=External22x^^5420!
      - WAGE_DB_NAME=ym_raw_data_downstream
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
      

