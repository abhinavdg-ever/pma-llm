version: '3.8'

services:
  contracts-copilot:
    build: .
    container_name: contracts-copilot
    ports:
      - "8080:8080"   # external:internal - nginx listens on 8080 internally
    restart: always
    environment:
      # MySQL Configuration
      - MYSQL_HOST=62.72.57.99
      - MYSQL_USER=aabo
      - MYSQL_PASSWORD=3#hxFkBFKJ2Ph!$$@
      - MYSQL_DATABASE=aaboRing10Jan
      # Llama Configuration
      - LLAMA_API_URL=http://34.131.37.125:11434/api/generate
      - LLAMA_MODEL=llama3
      # Qdrant Configuration
      - QDRANT_URL=http://34.131.37.125:6333
      - QDRANT_COLLECTION_NAME=contracts
      # Embedding Service Configuration
      - EMBEDDING_API_URL=http://34.131.37.125:8000/embed
      # OpenAI (optional)
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
    env_file:
      - ./local-llm/.env   # Load MYSQL_PASSWORD and other vars from .env file
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

